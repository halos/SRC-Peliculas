#!/usr/bin/python
# -*- coding: utf-8 -*-

__author__="sramirez"
__date__ ="$07-dic-2010 10:22:31$"


def class ItemAvgAdj1:
    
    """ Clase que implementa el método de prediccion Item Average Adjustament (All-1) """

    def __init__(self, idUsu, idItem):
	
	self.idUsu = idUsu
	self.idItem = idItem


    def mediausuario(self, valoraciones):

        lval_usuario = valoraciones.get(self.idUsu)

        nval = 0
        media_usuario = 0

        for valoracion in lval_usuario:
            if valoracion.getVal() != 0:
                media_usuario += valoracion.getVal()
                nval+= 1

        return media_usuario / nval

    def mediaitem(self, valoraciones):

        media_item = 0
        nval = 0

        for i in valoraciones.values():
            item = i.get(self.idItem)
            if item.getVal() != 0:
                media_item += item.getVal()
                nval += 1

        return media_item / nval

    def predice(self, similares, valoraciones):

        media_item = mediaitem(valoraciones)

        media_usuario = mediausuario(valoraciones)

        suma_denom = 0
	
	suma_num = 0

	"Cálculo de la fórmula de la prediccion"
	  
        for i in range(valoraciones):
	    if valoraciones[i] != 0:
		suma_denom += similares[i].getVal()
		suma_num += similares[i].getVal() * (valoraciones[i].getVal() - media_usuario)
	
	prediccion = suma_num / suma_denom + media_item

